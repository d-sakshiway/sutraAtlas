{% extends 'layout.html' %}
{% block title %}Edit Profile{% endblock %}
{% block body %}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow">
      <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
        <h3 class="mb-0"><i class="fas fa-user-edit"></i> Edit Profile</h3>
        <a href="/profile" class="btn btn-outline-light btn-sm">
          <i class="fas fa-arrow-left"></i> Back to Profile
        </a>
      </div>
      <div class="card-body">
        <form id="edit-form">
          <div class="mb-3">
            <label class="form-label">Email Address</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-envelope"></i></span>
              <div class="form-control bg-light" id="email">Loading...</div>
            </div>
            <div class="form-text text-muted">Email cannot be changed for security reasons</div>
          </div>
          <div class="mb-4">
            <label for="username" class="form-label">Username</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-user"></i></span>
              <input type="text" class="form-control" id="username" name="username" placeholder="Enter your username" />
            </div>
            <div class="form-text">This is your display name</div>
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-info btn-lg">
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
async function load(){
  const res = await fetch('/api/auth/me', {credentials:'include'});
  if(res.ok){
    const data = await res.json();
    document.getElementById('email').innerText = data.email;
    document.getElementById('username').value = data.username || '';
  } else location.href='/login'
}
// No need for back button event listener since it's now a link
document.getElementById('edit-form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const username = document.getElementById('username').value;
  const res = await fetch('/api/auth/me', {method:'PUT', credentials:'include', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username})});
  if(res.ok) location.href='/profile'; else window.showAlert('Failed to save changes','danger')
});
load();
</script>
{% endblock %}
